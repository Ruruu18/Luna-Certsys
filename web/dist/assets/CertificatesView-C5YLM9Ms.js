import{d as z,r as u,s as M,h as H,c as l,a as e,b as c,f as m,F as x,x as S,m as j,t as n,w as D,e as y,y as B,z as I,v as $,n as q,o as a}from"./index-_QPn6ggU.js";import{u as G}from"./certificates-DDZZFfAN.js";import{u as O}from"./users-CyS2RdYu.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"certificates-view"},Q={class:"view-header"},W={class:"header-right"},X={class:"filter-tabs"},Y=["onClick"],Z={key:0,class:"filter-count"},ee={class:"table-container"},te={key:0,class:"loading"},se={key:1,class:"alert alert-error"},oe={key:2,class:"empty-state"},le={key:3,class:"table"},ae={class:"certificate-type"},ne={class:"user-info"},ie={class:"user-name"},re={class:"user-email"},de={class:"purpose-text"},ue={class:"action-buttons"},ce=["onClick"],ve=["onClick"],pe=["onClick"],fe=["onClick"],me=["onClick"],be={class:"modal-header"},ke={class:"modal-title"},Ce={class:"modal-body"},ye={key:0,class:"alert alert-error"},ge={class:"form-group"},_e=["disabled"],he=["value"],we={class:"form-group"},Me=["disabled"],xe={class:"form-group"},Se=["disabled"],je={class:"form-group"},De=["disabled"],Be={class:"form-group"},Ve=["disabled"],Ae={class:"modal-footer"},Ue=["disabled"],$e=["disabled"],qe={key:0,class:"spinner"},Ee={class:"modal-body"},Le={class:"modal-footer"},Ne=["disabled"],Fe=["disabled"],Pe={key:0,class:"spinner"},Re=z({__name:"CertificatesView",setup(Te){const i=G(),V=O(),g=u(!1),p=u(!1),b=u(!1),r=u(!1),v=u(""),k=u(null),_=u(null),f=u("all"),d=u({user_id:"",certificate_type:"",purpose:"",status:"pending",notes:""}),E=M(()=>[{label:"All",value:"all",count:i.certificates.length},{label:"Pending",value:"pending",count:i.certificates.filter(o=>o.status==="pending").length},{label:"Approved",value:"approved",count:i.certificates.filter(o=>o.status==="approved").length},{label:"Completed",value:"completed",count:i.certificates.filter(o=>o.status==="completed").length},{label:"Rejected",value:"rejected",count:i.certificates.filter(o=>o.status==="rejected").length}]),A=M(()=>f.value==="all"?i.certificates:i.certificates.filter(o=>o.status===f.value)),L=M(()=>V.users.filter(o=>o.role!=="admin")),N=()=>{d.value={user_id:"",certificate_type:"",purpose:"",status:"pending",notes:""},v.value=""},h=()=>{g.value=!1,p.value=!1,_.value=null,N()},F=o=>{_.value=o,d.value={user_id:o.user_id,certificate_type:o.certificate_type,purpose:o.purpose,status:o.status,notes:o.notes||""},p.value=!0},P=o=>{k.value=o,b.value=!0},w=async(o,t)=>{const s={status:t};t==="approved"?s.approved_at=new Date().toISOString():t==="completed"&&(s.completed_at=new Date().toISOString()),await i.updateCertificateStatus(o.id,s)},U=async()=>{r.value=!0,v.value="";try{if(p.value&&_.value){const{success:o,error:t}=await i.updateCertificateStatus(_.value.id,d.value);if(!o){v.value=t||"Failed to update certificate";return}}else{const{success:o,error:t}=await i.addCertificate(d.value);if(!o){v.value=t||"Failed to create certificate";return}}h()}catch(o){v.value="An unexpected error occurred",console.error("Error submitting form:",o)}finally{r.value=!1}},R=async()=>{if(k.value){r.value=!0;try{const{success:o}=await i.removeCertificate(k.value.id);o&&(b.value=!1,k.value=null)}catch(o){console.error("Error deleting certificate:",o)}finally{r.value=!1}}},T=o=>new Date(o).toLocaleDateString();return H(async()=>{await Promise.all([i.fetchCertificates(),V.fetchUsers()])}),(o,t)=>(a(),l("div",K,[e("div",Q,[t[12]||(t[12]=e("div",{class:"header-left"},[e("h2",{class:"view-title"},"Certificate Management"),e("p",{class:"view-description"},"Manage certificate requests and approvals")],-1)),e("div",W,[e("button",{onClick:t[0]||(t[0]=s=>g.value=!0),class:"btn btn-primary"},[...t[11]||(t[11]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),m(" Add Certificate ",-1)])])])]),e("div",X,[(a(!0),l(x,null,S(E.value,s=>(a(),l("button",{key:s.value,onClick:C=>f.value=s.value,class:q(["filter-tab",{"filter-tab-active":f.value===s.value}])},[m(n(s.label)+" ",1),s.count!==void 0?(a(),l("span",Z,n(s.count),1)):c("",!0)],10,Y))),128))]),e("div",ee,[j(i).loading?(a(),l("div",te,[...t[13]||(t[13]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading certificates...",-1)])])):j(i).error?(a(),l("div",se,n(j(i).error),1)):A.value.length===0?(a(),l("div",oe,[t[14]||(t[14]=e("svg",{class:"empty-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[15]||(t[15]=e("h3",null,"No certificates found",-1)),e("p",null,n(f.value==="all"?"Get started by adding your first certificate":`No ${f.value} certificates`),1),e("button",{onClick:t[1]||(t[1]=s=>g.value=!0),class:"btn btn-primary"},"Add Certificate")])):(a(),l("table",le,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",null,"Certificate Type"),e("th",null,"Requestor"),e("th",null,"Purpose"),e("th",null,"Status"),e("th",null,"Requested"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),l(x,null,S(A.value,s=>(a(),l("tr",{key:s.id},[e("td",null,[e("div",ae,n(s.certificate_type),1)]),e("td",null,[e("div",ne,[e("div",ie,n(s.users?.full_name||"Unknown User"),1),e("div",re,n(s.users?.email||""),1)])]),e("td",null,[e("div",de,n(s.purpose),1)]),e("td",null,[e("span",{class:q(["badge",{"badge-warning":s.status==="pending","badge-info":s.status==="approved","badge-success":s.status==="completed","badge-danger":s.status==="rejected"}])},n(s.status),3)]),e("td",null,n(T(s.requested_at)),1),e("td",null,[e("div",ue,[s.status==="pending"?(a(),l("button",{key:0,onClick:C=>w(s,"approved"),class:"btn btn-success btn-sm",title:"Approve"},[...t[16]||(t[16]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,ce)):c("",!0),s.status==="pending"?(a(),l("button",{key:1,onClick:C=>w(s,"rejected"),class:"btn btn-danger btn-sm",title:"Reject"},[...t[17]||(t[17]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ve)):c("",!0),s.status==="approved"?(a(),l("button",{key:2,onClick:C=>w(s,"completed"),class:"btn btn-info btn-sm",title:"Mark as completed"},[...t[18]||(t[18]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,pe)):c("",!0),e("button",{onClick:C=>F(s),class:"btn btn-outline btn-sm",title:"Edit certificate"},[...t[19]||(t[19]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,fe),e("button",{onClick:C=>P(s),class:"btn btn-danger btn-sm",title:"Delete certificate"},[...t[20]||(t[20]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,me)])])]))),128))])]))]),g.value||p.value?(a(),l("div",{key:0,class:"modal",onClick:h},[e("div",{class:"modal-content",onClick:t[7]||(t[7]=D(()=>{},["stop"]))},[e("div",be,[e("h3",ke,n(p.value?"Edit Certificate":"Add New Certificate"),1)]),e("div",Ce,[e("form",{onSubmit:D(U,["prevent"])},[v.value?(a(),l("div",ye,n(v.value),1)):c("",!0),e("div",ge,[t[23]||(t[23]=e("label",{for:"user_id",class:"form-label"},"User",-1)),y(e("select",{id:"user_id","onUpdate:modelValue":t[2]||(t[2]=s=>d.value.user_id=s),class:"form-select",required:"",disabled:r.value},[t[22]||(t[22]=e("option",{value:""},"Select a user",-1)),(a(!0),l(x,null,S(L.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.full_name)+" ("+n(s.email)+") ",9,he))),128))],8,_e),[[B,d.value.user_id]])]),e("div",we,[t[25]||(t[25]=e("label",{for:"certificate_type",class:"form-label"},"Certificate Type",-1)),y(e("select",{id:"certificate_type","onUpdate:modelValue":t[3]||(t[3]=s=>d.value.certificate_type=s),class:"form-select",required:"",disabled:r.value},[...t[24]||(t[24]=[I('<option value="" data-v-443d96ff>Select certificate type</option><option value="Barangay Clearance" data-v-443d96ff>Barangay Clearance</option><option value="Certificate of Residency" data-v-443d96ff>Certificate of Residency</option><option value="Business Permit" data-v-443d96ff>Business Permit</option><option value="Certificate of Indigency" data-v-443d96ff>Certificate of Indigency</option><option value="Good Moral Certificate" data-v-443d96ff>Good Moral Certificate</option>',6)])],8,Me),[[B,d.value.certificate_type]])]),e("div",xe,[t[26]||(t[26]=e("label",{for:"purpose",class:"form-label"},"Purpose",-1)),y(e("textarea",{id:"purpose","onUpdate:modelValue":t[4]||(t[4]=s=>d.value.purpose=s),class:"form-input",rows:"3",required:"",disabled:r.value,placeholder:"Enter the purpose for this certificate..."},null,8,Se),[[$,d.value.purpose]])]),e("div",je,[t[28]||(t[28]=e("label",{for:"status",class:"form-label"},"Status",-1)),y(e("select",{id:"status","onUpdate:modelValue":t[5]||(t[5]=s=>d.value.status=s),class:"form-select",required:"",disabled:r.value},[...t[27]||(t[27]=[e("option",{value:"pending"},"Pending",-1),e("option",{value:"approved"},"Approved",-1),e("option",{value:"completed"},"Completed",-1),e("option",{value:"rejected"},"Rejected",-1)])],8,De),[[B,d.value.status]])]),e("div",Be,[t[29]||(t[29]=e("label",{for:"notes",class:"form-label"},"Notes (Optional)",-1)),y(e("textarea",{id:"notes","onUpdate:modelValue":t[6]||(t[6]=s=>d.value.notes=s),class:"form-input",rows:"2",disabled:r.value,placeholder:"Add any additional notes..."},null,8,Ve),[[$,d.value.notes]])])],32)]),e("div",Ae,[e("button",{onClick:h,type:"button",class:"btn btn-outline",disabled:r.value}," Cancel ",8,Ue),e("button",{onClick:U,type:"submit",class:"btn btn-primary",disabled:r.value},[r.value?(a(),l("div",qe)):c("",!0),m(" "+n(p.value?"Update":"Create")+" Certificate ",1)],8,$e)])])])):c("",!0),b.value?(a(),l("div",{key:1,class:"modal",onClick:t[10]||(t[10]=s=>b.value=!1)},[e("div",{class:"modal-content",onClick:t[9]||(t[9]=D(()=>{},["stop"]))},[t[34]||(t[34]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},"Confirm Deletion")],-1)),e("div",Ee,[e("p",null,[t[30]||(t[30]=m("Are you sure you want to delete this ",-1)),e("strong",null,n(k.value?.certificate_type),1),t[31]||(t[31]=m(" certificate?",-1))]),t[32]||(t[32]=e("p",{class:"text-sm text-gray-600"},"This action cannot be undone.",-1))]),e("div",Le,[e("button",{onClick:t[8]||(t[8]=s=>b.value=!1),type:"button",class:"btn btn-outline",disabled:r.value}," Cancel ",8,Ne),e("button",{onClick:R,type:"button",class:"btn btn-danger",disabled:r.value},[r.value?(a(),l("div",Pe)):c("",!0),t[33]||(t[33]=m(" Delete Certificate ",-1))],8,Fe)])])])):c("",!0)]))}}),Oe=J(Re,[["__scopeId","data-v-443d96ff"]]);export{Oe as default};
