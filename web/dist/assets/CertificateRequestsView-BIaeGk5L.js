import{A as z,r as f,G as I,H as G,I as J,J as O,d as K,s as x,h as Q,c as n,a as e,b,f as _,F as S,x as E,m as j,t as v,w as V,e as h,y as B,z as W,v as A,n as F,o as r}from"./index-_QPn6ggU.js";import{u as X}from"./users-CyS2RdYu.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z=z("certificateRequests",()=>{const g=f([]),l=f(!1),p=f(null);return{requests:g,loading:l,error:p,fetchRequests:async c=>{l.value=!0,p.value=null;try{const{data:a,error:u}=await I(c);if(u)throw u;g.value=a||[]}catch(a){p.value=a.message||"Failed to fetch certificate requests",console.error("Error fetching certificate requests:",a)}finally{l.value=!1}},addRequest:async c=>{l.value=!0,p.value=null;try{const{data:a,error:u}=await G(c);if(u)throw u;return a&&g.value.unshift(a),{success:!0}}catch(a){return p.value=a.message||"Failed to create certificate request",console.error("Error creating certificate request:",a),{success:!1,error:p.value}}finally{l.value=!1}},updateRequestStatus:async(c,a)=>{l.value=!0,p.value=null;try{const{data:u,error:m}=await J(c,a);if(m)throw m;if(u){const i=g.value.findIndex(q=>q.id===c);i!==-1&&(g.value[i]=u)}return{success:!0}}catch(u){return p.value=u.message||"Failed to update certificate request",console.error("Error updating certificate request:",u),{success:!1,error:p.value}}finally{l.value=!1}},removeRequest:async c=>{l.value=!0,p.value=null;try{const{error:a}=await O(c);if(a)throw a;return g.value=g.value.filter(u=>u.id!==c),{success:!0}}catch(a){return p.value=a.message||"Failed to delete certificate request",console.error("Error deleting certificate request:",a),{success:!1,error:p.value}}finally{l.value=!1}}}}),ee={class:"certificate-requests-view"},te={class:"view-header"},se={class:"header-right"},oe={class:"filter-tabs"},le=["onClick"],ae={key:0,class:"filter-count"},ne={class:"table-container"},re={key:0,class:"loading"},ie={key:1,class:"alert alert-error"},ue={key:2,class:"empty-state"},de={key:3,class:"table"},ce={class:"certificate-type"},ve={class:"user-info"},pe={class:"user-name"},fe={class:"user-email"},me={class:"purpose-text"},be={class:"amount"},ge={class:"action-buttons"},ye=["onClick"],ke=["onClick"],_e=["onClick"],he=["onClick"],Ce=["onClick"],we={class:"modal-header"},qe={class:"modal-title"},Re={class:"modal-body"},Me={key:0,class:"alert alert-error"},xe={class:"form-group"},Se=["disabled"],Ee=["value"],je={class:"form-group"},Ve=["disabled"],Be={class:"form-group"},Ae=["disabled"],De={class:"form-group"},Ue=["disabled"],Fe={class:"form-group"},$e=["disabled"],Ne={class:"form-group"},Pe=["disabled"],Le={class:"modal-footer"},He=["disabled"],Te=["disabled"],ze={key:0,class:"spinner"},Ie={class:"modal-body"},Ge={class:"modal-footer"},Je=["disabled"],Oe=["disabled"],Ke={key:0,class:"spinner"},Qe=K({__name:"CertificateRequestsView",setup(g){const l=Z(),p=X(),C=f(!1),y=f(!1),k=f(!1),d=f(!1),c=f(""),a=f(null),u=f(null),m=f("all"),i=f({user_id:"",certificate_type:"",purpose:"",status:"pending",notes:"",amount:0}),q=x(()=>[{label:"All",value:"all",count:l.requests.length},{label:"Pending",value:"pending",count:l.requests.filter(o=>o.status==="pending").length},{label:"In Progress",value:"in_progress",count:l.requests.filter(o=>o.status==="in_progress").length},{label:"Completed",value:"completed",count:l.requests.filter(o=>o.status==="completed").length},{label:"Rejected",value:"rejected",count:l.requests.filter(o=>o.status==="rejected").length}]),D=x(()=>m.value==="all"?l.requests:l.requests.filter(o=>o.status===m.value)),$=x(()=>p.users.filter(o=>o.role!=="admin")),N=()=>{i.value={user_id:"",certificate_type:"",purpose:"",status:"pending",notes:"",amount:0},c.value=""},R=()=>{C.value=!1,y.value=!1,u.value=null,N()},P=o=>{u.value=o,i.value={user_id:o.user_id,certificate_type:o.certificate_type,purpose:o.purpose,status:o.status,notes:o.notes||"",amount:o.amount||0},y.value=!0},L=o=>{a.value=o,k.value=!0},M=async(o,t)=>{const s={status:t};await l.updateRequestStatus(o.id,s)},U=async()=>{d.value=!0,c.value="";try{if(y.value&&u.value){const{success:o,error:t}=await l.updateRequestStatus(u.value.id,i.value);if(!o){c.value=t||"Failed to update request";return}}else{const{success:o,error:t}=await l.addRequest(i.value);if(!o){c.value=t||"Failed to create request";return}}R()}catch(o){c.value="An unexpected error occurred",console.error("Error submitting form:",o)}finally{d.value=!1}},H=async()=>{if(a.value){d.value=!0;try{const{success:o}=await l.removeRequest(a.value.id);o&&(k.value=!1,a.value=null)}catch(o){console.error("Error deleting request:",o)}finally{d.value=!1}}},T=o=>new Date(o).toLocaleDateString();return Q(async()=>{await Promise.all([l.fetchRequests(),p.fetchUsers()])}),(o,t)=>(r(),n("div",ee,[e("div",te,[t[13]||(t[13]=e("div",{class:"header-left"},[e("h2",{class:"view-title"},"Certificate Requests"),e("p",{class:"view-description"},"Manage certificate requests from mobile app")],-1)),e("div",se,[e("button",{onClick:t[0]||(t[0]=s=>C.value=!0),class:"btn btn-primary"},[...t[12]||(t[12]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),_(" Add Request ",-1)])])])]),e("div",oe,[(r(!0),n(S,null,E(q.value,s=>(r(),n("button",{key:s.value,onClick:w=>m.value=s.value,class:F(["filter-tab",{"filter-tab-active":m.value===s.value}])},[_(v(s.label)+" ",1),s.count!==void 0?(r(),n("span",ae,v(s.count),1)):b("",!0)],10,le))),128))]),e("div",ne,[j(l).loading?(r(),n("div",re,[...t[14]||(t[14]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading certificate requests...",-1)])])):j(l).error?(r(),n("div",ie,v(j(l).error),1)):D.value.length===0?(r(),n("div",ue,[t[15]||(t[15]=e("svg",{class:"empty-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[16]||(t[16]=e("h3",null,"No requests found",-1)),e("p",null,v(m.value==="all"?"No certificate requests yet":`No ${m.value} requests`),1),e("button",{onClick:t[1]||(t[1]=s=>C.value=!0),class:"btn btn-primary"},"Add Request")])):(r(),n("table",de,[t[22]||(t[22]=e("thead",null,[e("tr",null,[e("th",null,"Certificate Type"),e("th",null,"Requestor"),e("th",null,"Purpose"),e("th",null,"Amount"),e("th",null,"Status"),e("th",null,"Requested"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),n(S,null,E(D.value,s=>(r(),n("tr",{key:s.id},[e("td",null,[e("div",ce,v(s.certificate_type),1)]),e("td",null,[e("div",ve,[e("div",pe,v(s.users?.full_name||"Unknown User"),1),e("div",fe,v(s.users?.email||""),1)])]),e("td",null,[e("div",me,v(s.purpose),1)]),e("td",null,[e("div",be,"â‚±"+v(s.amount||0),1)]),e("td",null,[e("span",{class:F(["badge",{"badge-warning":s.status==="pending","badge-info":s.status==="in_progress","badge-success":s.status==="completed","badge-danger":s.status==="rejected"}])},v(s.status),3)]),e("td",null,v(T(s.created_at)),1),e("td",null,[e("div",ge,[s.status==="pending"?(r(),n("button",{key:0,onClick:w=>M(s,"in_progress"),class:"btn btn-info btn-sm",title:"Start processing"},[...t[17]||(t[17]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M19 10a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,ye)):b("",!0),s.status==="in_progress"?(r(),n("button",{key:1,onClick:w=>M(s,"completed"),class:"btn btn-success btn-sm",title:"Mark as completed"},[...t[18]||(t[18]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,ke)):b("",!0),s.status==="pending"?(r(),n("button",{key:2,onClick:w=>M(s,"rejected"),class:"btn btn-danger btn-sm",title:"Reject"},[...t[19]||(t[19]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,_e)):b("",!0),e("button",{onClick:w=>P(s),class:"btn btn-outline btn-sm",title:"Edit request"},[...t[20]||(t[20]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,he),e("button",{onClick:w=>L(s),class:"btn btn-danger btn-sm",title:"Delete request"},[...t[21]||(t[21]=[e("svg",{class:"btn-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ce)])])]))),128))])]))]),C.value||y.value?(r(),n("div",{key:0,class:"modal",onClick:R},[e("div",{class:"modal-content",onClick:t[8]||(t[8]=V(()=>{},["stop"]))},[e("div",we,[e("h3",qe,v(y.value?"Edit Request":"Add New Request"),1)]),e("div",Re,[e("form",{onSubmit:V(U,["prevent"])},[c.value?(r(),n("div",Me,v(c.value),1)):b("",!0),e("div",xe,[t[24]||(t[24]=e("label",{for:"user_id",class:"form-label"},"User",-1)),h(e("select",{id:"user_id","onUpdate:modelValue":t[2]||(t[2]=s=>i.value.user_id=s),class:"form-select",required:"",disabled:d.value},[t[23]||(t[23]=e("option",{value:""},"Select a user",-1)),(r(!0),n(S,null,E($.value,s=>(r(),n("option",{key:s.id,value:s.id},v(s.full_name)+" ("+v(s.email)+") ",9,Ee))),128))],8,Se),[[B,i.value.user_id]])]),e("div",je,[t[26]||(t[26]=e("label",{for:"certificate_type",class:"form-label"},"Certificate Type",-1)),h(e("select",{id:"certificate_type","onUpdate:modelValue":t[3]||(t[3]=s=>i.value.certificate_type=s),class:"form-select",required:"",disabled:d.value},[...t[25]||(t[25]=[W('<option value="" data-v-851a74aa>Select certificate type</option><option value="Barangay Clearance" data-v-851a74aa>Barangay Clearance</option><option value="Certificate of Residency" data-v-851a74aa>Certificate of Residency</option><option value="Business Permit" data-v-851a74aa>Business Permit</option><option value="Certificate of Indigency" data-v-851a74aa>Certificate of Indigency</option><option value="Good Moral Certificate" data-v-851a74aa>Good Moral Certificate</option>',6)])],8,Ve),[[B,i.value.certificate_type]])]),e("div",Be,[t[27]||(t[27]=e("label",{for:"purpose",class:"form-label"},"Purpose",-1)),h(e("textarea",{id:"purpose","onUpdate:modelValue":t[4]||(t[4]=s=>i.value.purpose=s),class:"form-input",rows:"3",required:"",disabled:d.value,placeholder:"Enter the purpose for this request..."},null,8,Ae),[[A,i.value.purpose]])]),e("div",De,[t[28]||(t[28]=e("label",{for:"amount",class:"form-label"},"Amount",-1)),h(e("input",{id:"amount","onUpdate:modelValue":t[5]||(t[5]=s=>i.value.amount=s),type:"number",step:"0.01",min:"0",class:"form-input",disabled:d.value,placeholder:"0.00"},null,8,Ue),[[A,i.value.amount,void 0,{number:!0}]])]),e("div",Fe,[t[30]||(t[30]=e("label",{for:"status",class:"form-label"},"Status",-1)),h(e("select",{id:"status","onUpdate:modelValue":t[6]||(t[6]=s=>i.value.status=s),class:"form-select",required:"",disabled:d.value},[...t[29]||(t[29]=[e("option",{value:"pending"},"Pending",-1),e("option",{value:"in_progress"},"In Progress",-1),e("option",{value:"completed"},"Completed",-1),e("option",{value:"rejected"},"Rejected",-1)])],8,$e),[[B,i.value.status]])]),e("div",Ne,[t[31]||(t[31]=e("label",{for:"notes",class:"form-label"},"Notes (Optional)",-1)),h(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=s=>i.value.notes=s),class:"form-input",rows:"2",disabled:d.value,placeholder:"Add any additional notes..."},null,8,Pe),[[A,i.value.notes]])])],32)]),e("div",Le,[e("button",{onClick:R,type:"button",class:"btn btn-outline",disabled:d.value}," Cancel ",8,He),e("button",{onClick:U,type:"submit",class:"btn btn-primary",disabled:d.value},[d.value?(r(),n("div",ze)):b("",!0),_(" "+v(y.value?"Update":"Create")+" Request ",1)],8,Te)])])])):b("",!0),k.value?(r(),n("div",{key:1,class:"modal",onClick:t[11]||(t[11]=s=>k.value=!1)},[e("div",{class:"modal-content",onClick:t[10]||(t[10]=V(()=>{},["stop"]))},[t[36]||(t[36]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},"Confirm Deletion")],-1)),e("div",Ie,[e("p",null,[t[32]||(t[32]=_("Are you sure you want to delete this ",-1)),e("strong",null,v(a.value?.certificate_type),1),t[33]||(t[33]=_(" request?",-1))]),t[34]||(t[34]=e("p",{class:"text-sm text-gray-600"},"This action cannot be undone.",-1))]),e("div",Ge,[e("button",{onClick:t[9]||(t[9]=s=>k.value=!1),type:"button",class:"btn btn-outline",disabled:d.value}," Cancel ",8,Je),e("button",{onClick:H,type:"button",class:"btn btn-danger",disabled:d.value},[d.value?(r(),n("div",Ke)):b("",!0),t[35]||(t[35]=_(" Delete Request ",-1))],8,Oe)])])])):b("",!0)]))}}),Ze=Y(Qe,[["__scopeId","data-v-851a74aa"]]);export{Ze as default};
